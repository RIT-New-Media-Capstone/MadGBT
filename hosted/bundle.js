(()=>{let e,t={},n={};async function l(){const e=await fetch("/generate-story");if(!e.ok){const t=`An error has occured: ${e.status}`;throw new Error(t)}return(await e.json()).content}const o=()=>{window.scrollTo(0,0)},s=(e,t)=>{const n=t||(e=>e),l={};for(let t=0;t<e.length;t++){const o=e[t];l[o]=document.querySelector(`#${n(o)}`)}return l},r=e=>{t[e]&&(Object.keys(t).forEach((n=>{t[n].classList.toggle("activeScreen",n===e)})),o())},i=e=>{n.waitingMessage.innerText=e,r("waiting")},a=e=>{n.fillInBlanksFormBlanks.innerHTML=e.map(((e,t)=>`<div><label for="${t}">${e}:</label><input type="text" name="${t}"></div>`)).join(""),r("fillInBlanks")},c=t=>{console.log("working"),t.preventDefault();const l=[];let s=!0;n.fillInBlanksFormBlanks.querySelectorAll("input").forEach((e=>{const t=e.value;l.push(t),t.length>0?e.classList.remove("formMissedRequirement"):(e.classList.add("formMissedRequirement"),s=!1)})),s?e(l):o()},g=async e=>{let t=[],n=[];for(let l=0;l<e.length;l++)if("["==e[l])t.push(l);else if("]"==e[l]&&t.length>0){let o=t[t.length-1];t.pop();let s,r=l-1-o;s=o<r?e.substring(o+1,r+1):e.substring(o+1,r+o+1),n.push(s)}return console.log("wordTypes",n),n};window.onload=async()=>{let o,u=[];t=s(["start","waiting","fillInBlanks","results"],(e=>`${e}Screen`)),n=s(["startGameButton","errorMessage","waitingMessage","fillInBlanksForm","fillInBlanksFormBlanks","finishedStory","playAgainButton"]),n.fillInBlanksForm.addEventListener("submit",c),n.startGameButton.onclick=()=>{i("Getting Prompt..."),madlibPrompt=l(),madlibPrompt.then((e=>{console.log("response",e),o=e,g(e).then((e=>{a(e),u=e}))}))},n.playAgainButton.onclick=()=>{i("Getting Prompt..."),madlibPrompt=l(),madlibPrompt.then((e=>{console.log("response",e),o=e,g(e).then((e=>{a(e),u=e}))}))},e=async e=>{(e=>{let t="";if(e.includes("Title:")){let n=e.indexOf("\n"),l=e.substring(e.indexOf("Title:")+7,n);console.log("title",l),t+=`<strong>${l}</strong><br>`,t+=e.substring(n,e.length-1)}else t=e;n.finishedStory.innerHTML=t,r("results")})(((e,t,n)=>{let l=n;for(let n=0;n<e.length;n++)l=l.replace(`[${t[n]}]`,`<span style="color:red">${e[n]}</span>`);return l})(e,u,o));const t=await(async e=>{try{return await fetch("/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})}).then((e=>e.json())).then((e=>e))}catch(e){console.log(e)}})(((e,t,n)=>{let l=n;for(let n=0;n<e.length;n++)l=l.replace(`[${t[n]}]`,`${e[n]}`);return l})(e,u,o));var l;console.log(t),t.error||(l=t.url,document.getElementById("storyImage").src=l)}}})();